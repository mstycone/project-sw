<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style-sw/style.css" type="text/css">
  <title>Visualisation</title>
  <!-- Intégration de Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Visualisation des Transactions</h1>
    <nav>
      <a href="index.html">Accueil</a>
      <a href="add-transac.html">Ajouter une transaction</a>
      <a href="transac.html">Voir les transactions</a>
      <a href="visualisation.html" class="active">Visualisation</a>
    </nav>
  </header>

    <main>
        <div class="conteneur-graph">
            <div class="graph">
                <h2>Graphique des dépenses/revenus</h2>
                <canvas id="transactionChart" width="400" height="200"></canvas> <!-- Diagramme de comparaison -->
            </div>
            <div class="graph">
                <h2>Répartition des Dépenses</h2>
                <canvas id="expenseChart" width="400" height="200"></canvas> <!-- Diagramme en cercle -->
            </div>
        </div>
    </main>
  <footer>
    <p>© 2024 SpendWise. Tous droits réservés.</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
        // Récupérer les transactions depuis localStorage
        let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

        // Initialiser les variables pour les dépenses et revenus
        let depenseTotal = 0;
        let revenueTotal = 0;

        // Initialiser un objet pour les dépenses par catégorie
        let categories = {};

        // Parcourir les transactions pour calculer les totaux
        transactions.forEach(function(transaction) {
            if (transaction.type === "depense") {
                depenseTotal += parseFloat(transaction.montant);
                // Catégoriser les dépenses
                if (categories[transaction.categorie]) {
                    categories[transaction.categorie] += parseFloat(transaction.montant);
                } else {
                    categories[transaction.categorie] = parseFloat(transaction.montant);
                }
            } else if (transaction.type === "revenue") {
                revenueTotal += parseFloat(transaction.montant);
            }
        });

        // Configuration du diagramme de comparaison
        let ctx1 = document.getElementById('transactionChart').getContext('2d');
        let transactionChart = new Chart(ctx1, {
            type: 'bar', // Type de graphique
            data: {
                labels: ['Revenus', 'Dépenses'], // Légendes
                datasets: [{
                    label: 'Montant (€)',
                    data: [revenueTotal, depenseTotal], // Données à visualiser
                    backgroundColor: [
                        'rgba(75, 192, 192, 0.6)', // Couleur pour les revenus
                        'rgba(255, 99, 132, 0.6)'  // Couleur pour les dépenses
                    ],
                    borderColor: [
                        'rgba(75, 192, 192, 1)',    // Bordure pour les revenus
                        'rgba(255, 99, 132, 1)'     // Bordure pour les dépenses
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true // Le graphique commence à zéro
                    }
                },
                plugins: {
                    legend: {
                        display: true, // Afficher la légende
                        position: 'top'
                    },
                    title: {
                        display: true,
                        text: 'Visualisation des revenus et dépenses'
                    }
                }
            }
        });

        // Préparer les données pour le diagramme en cercle
        const expenseLabels = Object.keys(categories);
        const expenseData = Object.values(categories);

        // Configuration du diagramme en cercle
        let ctx2 = document.getElementById('expenseChart').getContext('2d');
        let expenseChart = new Chart(ctx2, {
            type: 'pie', // Type de graphique
            data: {
                labels: expenseLabels, // Catégories de dépenses
                datasets: [{
                    label: 'Dépenses par catégorie',
                    data: expenseData, // Données des dépenses par catégorie
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.6)',
                        'rgba(54, 162, 235, 0.6)',
                        'rgba(255, 206, 86, 0.6)',
                        'rgba(75, 192, 192, 0.6)',
                        'rgba(153, 102, 255, 0.6)',
                        'rgba(255, 159, 64, 0.6)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true, // Adaptation responsive
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    title: {
                        display: true,
                        text: 'Répartition des Dépenses'
                    }
                }
            }
        });
    });
  </script>
</body>
</html>
