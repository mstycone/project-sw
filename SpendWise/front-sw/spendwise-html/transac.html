<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style-sw/style.css" type="text/css">
  <title>SpendWise - Transactions</title>
</head>
<body>
  <header>
    <h1>SPEND<span class="title-sw-white">WISE</span></h1>
    <nav>
      <a href="index.html">Accueil</a>
      <a href="add-transac.html">Ajouter une transaction</a>
      <a href="transac.html" class="active">Voir les transactions</a>
      <a href="visualisation.html">Visualisation</a>
    </nav>
  </header>

  <main>
    <table>
      <thead>
        <tr>
          <th>Description</th>
          <th>Montant</th>
          <th>Type</th>
          <th>Actions</th> <!-- Colonne pour les boutons de suppression et modification -->
        </tr>
      </thead>
      <tbody id="transac-list">
        <!-- Transactions dynamiques -->
      </tbody>
    </table>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

      let transacList = document.getElementById("transac-list");

      if (transactions.length === 0) {
        let emptyRow = document.createElement("tr");
        let emptyCell = document.createElement("td");
        emptyCell.setAttribute("colspan", 4); // Fusionne les colonnes
        emptyCell.textContent = "Aucune transaction à afficher";
        emptyRow.appendChild(emptyCell);
        transacList.appendChild(emptyRow);
      }else {
        transactions.forEach(function(transaction, index) {
            let row = document.createElement("tr");

            let descCell = document.createElement("td");
            descCell.textContent = transaction.categorie;
            row.appendChild(descCell);

              let montantCell = document.createElement("td");
              montantCell.textContent = transaction.montant.toFixed(2) + " €";
              row.appendChild(montantCell);

              let typeCell = document.createElement("td");
              typeCell.textContent = transaction.type;
              row.appendChild(typeCell);

              // Ajouter les boutons de suppression et modification
              let actionCell = document.createElement("td");

              let editBtn = document.createElement("button");
              // Bouton Modifier
              editBtn.setAttribute("class", "button-add-transac");
              editBtn.textContent = "Modifier";
              editBtn.addEventListener("click", function() {
                // Remplacer les cellules par des champs de saisie pour modification
                descCell.innerHTML = `<input type="text" value="${transaction.categorie}" id="edit-categorie-${index}">`;
                montantCell.innerHTML = `<input type="number" value="${transaction.montant}" id="edit-montant-${index}">`;
                typeCell.innerHTML = `
                  <select id="edit-type-${index}">
                    <option value="revenue" ${transaction.type === 'revenue' ? 'selected' : ''}>Revenu</option>
                    <option value="depense" ${transaction.type === 'depense' ? 'selected' : ''}>Dépense</option>
                  </select>`;

                // Remplacer le bouton Modifier par un bouton Sauvegarder
                editBtn.style.display = "none"; // Cacher le bouton Modifier
                let saveBtn = document.createElement("button");
                saveBtn.setAttribute("class", "button-add-transac");
                saveBtn.textContent = "Sauvegarder";
                actionCell.appendChild(saveBtn);

                saveBtn.addEventListener("click", function() {
                  //Demande de confirmation avant action (booléen)
                  if (confirm("Voulez-vous sauvegarder les modifications ?")) {
                    // Récupérer les nouvelles valeurs des champs
                    let newCategorie = document.getElementById(`edit-categorie-${index}`).value;
                    let newMontant = parseFloat(document.getElementById(`edit-montant-${index}`).value);
                    let newType = document.getElementById(`edit-type-${index}`).value;

                    // Mettre à jour la transaction dans le tableau et dans localStorage
                    transactions[index] = {
                      categorie: newCategorie,
                      montant: newMontant,
                      type: newType
                    };
                    localStorage.setItem("transactions", JSON.stringify(transactions)); // Mettre à jour localStorage
                    location.reload(); // Recharger la page pour refléter les changements
                  }
                });

                //Ajout un bouton 'Annuler'
                let cancelBtn = document.createElement("button");
                cancelBtn.setAttribute("class", "button-add-transac");
                cancelBtn.textContent = "Annuler";
                actionCell.appendChild(cancelBtn);

                //Reprend les valeurs de bases 
                cancelBtn.addEventListener("click", function() {
                  descCell.innerHTML = transaction.categorie; 
                  montantCell.innerHTML = transaction.montant.toFixed(2) + " €";
                  typeCell.innerHTML = transaction.type;

                  //Réafficher les boutons de départ 
                  editBtn.style.display = "inline";
                  saveBtn.remove();
                  cancelBtn.remove();
                });
              });
              actionCell.appendChild(editBtn);

              // Bouton Supprimer
              let deleteBtn = document.createElement("button");
              deleteBtn.setAttribute("class", "button-add-transac");
              deleteBtn.textContent = "Supprimer";
              deleteBtn.addEventListener("click", function() {
                //Demande de confirmation avant action (booléen)
                if (confirm("Êtes-vous sûr de vouloir supprimer cette transaction ?")) {
                  transactions.splice(index, 1); // Supprimer la transaction de la liste
                  localStorage.setItem("transactions", JSON.stringify(transactions)); // Mettre à jour le localStorage
                  location.reload(); // Recharger la page pour mettre à jour la liste
                }
              });
              actionCell.appendChild(deleteBtn);

              row.appendChild(actionCell);
              transacList.appendChild(row);
          });
      }
    });
  </script>
</body>
</html>
